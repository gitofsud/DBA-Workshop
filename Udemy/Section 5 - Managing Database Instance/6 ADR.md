# Automatic Diagnostic Repository

* It is a file based repository outside database

* It is a system wide central tracing and logging repository

* It stores database diagnostic data such as:
    - Traces
    - Alert log
    - Health monitor reports

* Typical installation will have **ADR_BASE** set to *ORACLE_BASE*

* Parameter - **diagnostic_dest**

* ADR home path

        {ADR_BASE}/diag/product_type/db_id/instance_id


## Alert log

* It is a chronological log of messages and errors, and includes the following items:

    - Any non default initialization parameter used at startup
    - All internal errors (ORA-00600), block corruption errors (ORA-01578) and deadlock errors (ORA-00060) that occur
    - Admin operations, such as CREATE, ALTER, DROP, STARTUP, SHUTDOWN, ARCHIVELOG, etc
    - Messages and errors of server and dispatcher
    - Errors during automatic refresh of materialized view
    - Locations of diagnostic directories using **V$DIAG_INFO** view
    - Can view using text editor 

### ADRCI

        show alert


## Trace files

* It contains
    - Error information (contact Oracle Support Services if internal error occurs)
    - Information that can provide guidance for tuning applications or an instance

* Each server and background processes can write to an associated trace file

* Trace file names for background processes are named after their processes.
    - Exception: Trace files generated by job queue processes

* Oracle Database includes an advanced fault diagnosability infrastructure for preventing, detecting, diagnosing and resolving problems

* When a critical error occurs:
    - An incident number is assigned to the error
    - Diagnostic data for error is immediately captured and tagged with incident number
    - Data is stored in ADR

* ADR files can be automatically purged with retention policy parameters


## DDL Logging

* Go to {ORACLE_HOME}/diag/rdbms/orcl/orcl/log/ddl
* Open SQLPLUS and go to PDB

        SHOW PARAMETER ddl;
        ALTER SESSION SET enable_ddl_logging=true;

### Purging Mechanism

* It allows to specify retention policy
    - Retention period of ADR contents before deleted
        * Long retention period - Default is 365 days
        * Short retention period - Default is 30 days
    - Older items are deleted first
    - Size based retention


### SQL Statements


        adrci> set HOMEPATH diag/rdbms/orcl/orcl


        adrci> select sizep_policy from adr_control_aux

        18446744073709551615

        adrci> select shortp_policy, longp_policy from adr_control;

        SHORTP_POLICY        LONGP_POLICY   (in hours)      
        -------------------- -------------------- 
        720                  8760  

        

        adrci> estimate ( sizep_policy =200000000) ;

        adrci> estimate ( shortp_policy =192, longp_policy=192 ) ;

        ADRCI> set control (SHORTP_POLICY = 192)
        ADRCI> set control (LONGP_POLICY = 192)
        ADRCI> set control (SIZEP_POLICY = 8559020)